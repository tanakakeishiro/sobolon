---
alwaysApply: true
---

コミットメッセージ生成ルール（Cursor AI / MCP 用）

## 方針

- AI が生成するコミットメッセージは「Conventional Commits」に準拠
- **コミットメッセージは必ず日本語で生成**
- 和文の本文要約を含め、必要に応じて箇条書きで詳細
- 変更の対象（HTML/SCSS/CSS/JS/画像/設定）を明確化
- スコープは BEM やコンポーネント名・セクション名で具体化
- 履歴から「いつ／だれが／なぜ／何を」が明確に分かるようにする
- 他者や将来の自分が読みやすく理解しやすいコミットを作成

## フォーマット

<type>(<scope>): <subject>

<body>

<footer>

## type 一覧

- feat: 新機能
- fix: バグ修正
- docs: ドキュメントのみ
- style: フォーマット/空白/セミコロン等（機能変更なし）
- refactor: リファクタ（機能追加/修正なし）
- perf: パフォーマンス改善
- test: テスト追加/修正
- build: ビルド関連
- ci: CI 設定
- chore: 雑務（依存更新等）
- revert: 取り消し

## 必須ルール

1. **subject は 50 文字以内・命令形・末尾に句読点なし・必ず日本語**
2. body は必要な場合のみ。箇条書きで簡潔に（日本語 OK）
3. 変更範囲が複数に渡る場合はスコープをカンマで列挙（例: feat(header, button): ...）
4. デザイン値は直書き禁止の旨に触れる（必要時）
5. 画像追加時は命名規則（小文字/ハイフン/連番 02〜）への準拠を明記
6. ブレークポイントは @mixin mq() 利用を明記（直接 @media 禁止）
7. コミットは 1 つの関心ごと（目的）に基づく変更のみを含む
8. 大きな機能はブランチ単位で管理し、サブタスクごとにコミットを分割
9. 近接する変更は git add -p を使って hunk 単位でステージング可能
10. **英語でのコミットメッセージ生成は絶対に禁止**

## 自動チェック（必須）

以下に一致しない生成は「無効」とし、AI はヘッダ再生成を求めること。

- 許可 type: feat, fix, docs, style, refactor, test, chore, perf, build, ci, revert
- scope は任意だが () で囲む
- subject は必須、命令形、最大 50 文字、日本語のみ
- 正規表現: `^(feat|fix|docs|style|refactor|test|chore|perf|build|ci|revert)(\([a-zA-Z0-9_-]+\))?:\s(#\d+\s)?[^\n]{1,50}$`

拒否されるヘッダ例：

- 日本語 type や自由形式: 「新規ファイル(css): ...」
- type 未指定: 「(header): ...」
- 末尾句読点付きの subject
- subject が 51 文字以上
- 許可外 type

不一致時の挙動: 「ヘッダが規約に一致しません。type(scope): subject 形式で再生成してください。」

## AI へのプロンプト指示（必須手順）

**【重要】コミットメッセージは必ず日本語で生成すること**

### 変更差分分析プロセス

1. **変更ファイルの特定と分類**

   - 追加・削除・変更・リネームされたファイルを分類

2. **変更タイプの判定**

   - **feat**: 新機能追加（新しいファイル追加、機能拡張、API追加）
   - **fix**: バグ修正（エラー修正、動作不良の修正、テスト失敗の修正）
   - **refactor**: リファクタリング（機能変更なし、コード整理、構造改善）
   - **style**: スタイル変更（フォーマット、インデント、空白、セミコロン）
   - **perf**: パフォーマンス改善（速度向上、メモリ最適化）
   - **test**: テスト関連（テスト追加・修正・削除）
   - **docs**: ドキュメント（README、コメント、ドキュメントファイル）
   - **build**: ビルド関連（ビルド設定、依存関係、ツール設定）
   - **ci**: CI/CD設定（GitHub Actions、CircleCI等）
   - **chore**: 雑務（依存更新、設定変更、その他）
   - **revert**: 取り消し（以前のコミットの取り消し）

3. **スコープの推測**

   - ファイルパスから推測：
     - `components/header/` → `header`
     - `pages/index/` → `index`
     - `utils/` → `utils`
     - `styles/components/_button.scss` → `button`
     - `src/api/auth.ts` → `auth`
   - 複数コンポーネントにまたがる場合はカンマ区切り
   - 特定できない場合は `global` を使用

4. **subject の生成**

   - 命令形で記述（「追加する」「修正する」「削除する」等）
   - 50文字以内、日本語のみ、句読点なし
   - 具体的で明確な内容

5. **body の生成（必要な場合）**
   - 変更の詳細を箇条書きで記述
   - 変更したファイルとその内容
   - 技術的な詳細（変数使用、命名規則遵守等）

### ファイルパターンマッチング

- **コンポーネント**: `components/`, `src/components/`, `app/components/` → ディレクトリ名
- **ページ**: `pages/`, `src/pages/`, `app/pages/` → ページ名
- **スタイル**: `styles/`, `sass/`, `css/` → ファイル名からコンポーネント名を抽出
- **ユーティリティ**: `utils/`, `lib/`, `helpers/` → `utils` または具体的な機能名
- **API**: `api/`, `src/api/` → エンドポイント名または機能名
- **テスト**: `tests/`, `__tests__/`, `spec/` → `test` または対象コンポーネント名
- **設定**: `config/`, `.github/`, `.vscode/` → 設定の種類（`build`, `ci`, `chore`等）

### 特殊ケースの処理

- **複数の変更タイプが混在**: 最も主要な変更タイプを選択、body で他の変更タイプも言及
- **リファクタリングとバグ修正が混在**: バグ修正が主目的なら `fix`、リファクタリングが主目的なら `refactor`
- **新機能とリファクタリングが混在**: 新機能が主目的なら `feat`、リファクタリングが主目的なら `refactor`
- **スタイル変更と機能変更が混在**: 機能変更が主目的なら `feat` または `fix`、スタイル変更のみなら `style`

### 生成時のチェックリスト

- [ ] type が適切か（変更内容と一致しているか）
- [ ] scope が適切か（ファイルパスから推測できているか）
- [ ] subject が50文字以内か
- [ ] subject が命令形で日本語か
- [ ] subject に句読点がないか
- [ ] body が必要な場合に記述されているか
- [ ] 英語が含まれていないか
- [ ] 変更内容が明確に記述されているか

### 精度向上のためのルール

1. **曖昧な表現を避ける**

   - ❌ "バグを修正" → ✅ "ログイン時のエラーメッセージが表示されない問題を修正"

2. **技術的な詳細を含める**

   - ❌ "スタイルを変更" → ✅ "ボタンのホバー時の色を変数 $color-primary に統一"

3. **影響範囲を明確にする**

   - ❌ "API を修正" → ✅ "ユーザー認証 API のトークン検証ロジックを修正"

4. **変更の理由を含める（必要な場合）**
   - ❌ "コードを整理" → ✅ "重複コードを削除し、共通関数に集約して保守性を向上"

## 例（参考）

### 新機能追加

feat(auth): #42 パスワードリセット機能を追加

ユーザーがメールアドレスを用いてパスワードリセットできるようにしました。
トークンの有効期限設定およびエラーハンドリングも実装済み。

Closes #42

feat(header): ナビゲーションメニューを追加

- components/Header.tsx にドロップダウンメニューを実装
- レスポンシブ対応（モバイルではハンバーガーメニュー）

### バグ修正

fix(api): #77 認証トークンの有効期限チェックを修正

前の実装では、有効期限切れチェックのロジックにバグがあり、切れていないトークンも拒否されていました。
チェック処理を改善し、既存テストを修正。

Closes #77

fix(button): ホバー時のスタイルが適用されない問題を修正

- :hover 疑似クラスの優先度を修正
- テストを追加して再発防止

### リファクタリング

refactor(db): クエリ最適化

users テーブルの SELECT クエリをインデックスを用いるよう修正。
パフォーマンス向上を確認済み。

### スタイル変更

style(global): コードフォーマットを統一

- Prettier の設定に合わせてフォーマット
- 機能変更なし

### 複数スコープ

feat(header, footer): ナビゲーションを追加

- ヘッダーとフッターに共通のナビゲーションコンポーネントを追加
- レスポンシブ対応

## 禁止事項

- **英語でのコミットメッセージ生成（厳禁）**
- 英語と日本語が混在した不自然な subject
- 目的が不明確な抽象的メッセージ
- 複数目的を同一コミットに混在
- body が空で変更理由が不明

## エラーハンドリング

生成されたメッセージが規約に一致しない場合、以下を確認して再生成：

1. **ヘッダ形式が不正**: type が許可されていない、scope の形式が不正、subject が50文字を超えている、句読点が含まれている、英語が含まれている
2. **内容が不適切**: 変更内容とメッセージが一致していない、曖昧で理解しにくい、技術的な詳細が不足している
3. **再生成時の対応**: エラーの原因を特定、正しい形式で再生成、変更差分を再度分析

変更内容が不明確な場合（複数の解釈が可能、スコープの特定が困難、変更タイプの判定が困難）は、ユーザーに確認を求めること。

## グローバル適用のための注意事項

このルールファイルは `alwaysApply: true` が設定されているため、すべてのプロジェクトで自動的に適用されます。

プロジェクト固有のルールが必要な場合は、プロジェクトルートに `.cursorrules` ファイルを作成し、追加ルールを定義できます。プロジェクト固有のルールは、このグローバルルールに追加される形で適用されます。
