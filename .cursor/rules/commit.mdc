---
alwaysApply: true
---

コミットメッセージ生成ルール（Cursor AI / MCP 用）

## 方針

- AI が生成するコミットメッセージは「Conventional Commits」に準拠
- **コミットメッセージは必ず日本語で生成**
- 和文の本文要約を含め、必要に応じて箇条書きで詳細
- 変更の対象（HTML/SCSS/CSS/JS/画像/設定）を明確化
- スコープは BEM やコンポーネント名・セクション名で具体化
- 履歴から「いつ／だれが／なぜ／何を」が明確に分かるようにする
- 他者や将来の自分が読みやすく理解しやすいコミットを作成

## フォーマット

<type>(<scope>): <subject>

<body>

<footer>

### 例

- feat(header): PC ファーストのレイアウト実装

  - index.html にヒーローセクションを追加
  - sass/page/\_index.scss に基本レイアウトと@include mq(sp)を追加
  - 変数は sass/global/\_variables.scss を使用

- fix(button): :hover の色が変数と不一致の問題を修正

  - $color-primary に統一

- style(global): フォーマットのみ（機能変更なし）

## type 一覧

- feat: 新機能
- fix: バグ修正
- docs: ドキュメントのみ
- style: フォーマット/空白/セミコロン等（機能変更なし）
- refactor: リファクタ（機能追加/修正なし）
- perf: パフォーマンス改善
- test: テスト追加/修正
- build: ビルド関連
- ci: CI 設定
- chore: 雑務（依存更新等）
- revert: 取り消し

## ルール

1. **subject は 50 文字以内・命令形・末尾に句読点なし・必ず日本語**
2. body は必要な場合のみ。箇条書きで簡潔に（日本語 OK）
3. 変更範囲が複数に渡る場合はスコープをカンマで列挙（例: feat(header, button): ...）
4. デザイン値は直書き禁止の旨に触れる（必要時）
5. 画像追加時は命名規則（小文字/ハイフン/連番 02〜）への準拠を明記
6. ブレークポイントは @mixin mq() 利用を明記（直接 @media 禁止）
7. コミットは 1 つの関心ごと（目的）に基づく変更のみを含む
8. 大きな機能はブランチ単位で管理し、サブタスクごとにコミットを分割
9. 近接する変更は git add -p を使って hunk 単位でステージング可能
10. **英語でのコミットメッセージ生成は絶対に禁止**

## 自動チェック（Lint）用正規表現（厳格モード）

本節のチェックは「必須」。以下に一致しない生成は「無効」とし、AI はヘッダ再生成（またはユーザー修正）を求めること。
許可外の type やヘッダ形式（例: 「新規ファイル: ...」）は受け付けない。

### type / subject チェック（必須）

- 許可 type: feat, fix, docs, style, refactor, test, chore, perf, build, ci, revert
- scope は任意だが () で囲む
- Issue 番号は任意だが #数字 形式
- subject は必須、命令形、最大 50 文字
- 正規表現（ヘッダ行にのみ適用、マルチラインの先頭で評価）
  - 先頭に許可 type、任意 scope、任意 Issue、50 文字以内 subject
  - 不一致ならエラーとし、再生成を要求
  - regex
    ^(feat|fix|docs|style|refactor|test|chore|perf|build|ci|revert)(\([a-zA-Z0-9_-]+\))?:\s(#\d+\s)?[^\n]{1,50}$

### body チェック（条件付き）

- 空行の後に本文があるか確認
- 内容: 変更理由、背景、影響範囲など
- 箇条書き可

regex
^\n.+$

### footer チェック（条件付き）

- Issue クローズ指示や BREAKING CHANGE がある場合のみ必須
- 正規表現例：

regex
^(Closes|Fixes) #\d+|BREAKING CHANGE: .+$

### 拒否ルール（必須）

- 次のようなヘッダは拒否（エラー）
  - 日本語 type や自由形式例: 「新規ファイル(css.mdc): ...」
  - type 未指定例: 「(header): ...」
  - 末尾句読点付きの subject
  - subject が 51 文字以上
  - 許可外 type（上記一覧にない）

不一致時の挙動:

- メッセージ: 「ヘッダが規約に一致しません。type(scope): subject 形式で再生成してください。」
- 可能なら差分から最適な type 候補を提示（feat/fix/docs/style/refactor など）

## AI へのプロンプト指示（内部）

**【重要】コミットメッセージは必ず日本語で生成すること**

- 変更差分を解析し、最も適切な type を選択
- スコープには該当するコンポーネント名、セクション名、または `global` を使用
- subject は簡潔に**日本語で**記述。body では:

  - どのファイルに何をしたか（日本語で）
  - 変数/ミキシン使用の遵守
  - BEM/命名規則の遵守
  - レスポンシブは 768px 基準（mq(sp)）

- 変更がリファクタのみなら `refactor`、見た目のみなら `style`
- **英語でのコミットメッセージ生成は禁止**

## テンプレート（AI 用）

type: <feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert>
scope: <component-or-section|global>
subject: <命令形・50 字以内>
body:

- <ファイル> に <変更要約>
- 変数/ミキシンの利用: <yes/no + 補足>
- BEM/命名規則: <遵守/非遵守>
- レスポンシブ: <mq(sp)/なし>
  footer:
- Issue: <#番号があれば>

## 禁止事項

- **英語でのコミットメッセージ生成（厳禁）**
- 英語と日本語が混在した不自然な subject
- 目的が不明確な抽象的メッセージ
- デザイン値の直書きを肯定する表現
- 複数目的を同一コミットに混在
- body が空で変更理由が不明
- footer に関連 Issue がない場合

## 例

feat(auth): #42 パスワードリセット機能を追加

ユーザーがメールアドレスを用いてパスワードリセットできるようにしました。
トークンの有効期限設定およびエラーハンドリングも実装済み。

Closes #42

fix(api): #77 認証トークンの有効期限チェックを修正

前の実装では、有効期限切れチェックのロジックにバグがあり、切れていないトークンも拒否されていました。
チェック処理を改善し、既存テストを修正。

Closes #77

refactor(db): クエリ最適化

users テーブルの SELECT クエリをインデックスを用いるよう修正。
パフォーマンス向上を確認済み。

chore(deps): ライブラリ更新

lodash を v4.17.21 に更新。
破壊的変更なし。
